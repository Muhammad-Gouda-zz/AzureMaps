<!DOCTYPE html>
<html>

<head>
  <title>Azure Maps Demo</title>

  <meta charset="utf-8">

  <!-- Ensures that IE and Edge uses the latest version and doesn't emulate an older version -->
  <meta http-equiv="x-ua-compatible" content="IE=Edge">

  <!-- Ensures the web page looks good on all screen sizes -->
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <!-- Add references to the Azure Maps Map control JavaScript and CSS files -->
  <link rel="stylesheet" href="https://atlas.microsoft.com/sdk/javascript/mapcontrol/2/atlas.min.css" type="text/css">
  <script src="https://atlas.microsoft.com/sdk/javascript/mapcontrol/2/atlas.min.js"></script>

  <!-- Add references to local JavaScriptand CSS files -->
  <link rel="stylesheet" href="css/style.css" type="text/css">
  <script src="js/vehicles.js"></script>
  <script src="js/zones.js"></script>
</head>

<body>
  <h1> Azure Maps Sandbox</h1>
  <div id="myMap"></div>

  <script type="text/javascript">

    mapObj = {
      center: [-111.917202, 40.97946],
      zoom: 14,
      language: 'en-US',
      authOptions: {
        authType: 'subscriptionKey',
        subscriptionKey: '6_8knM0AnqJpKTYquWanWZEMFBnLD9uU-Z82hpWEuO4'
      }
    };
    map = new atlas.Map('myMap', mapObj);

    map.events.add('ready', render);


    function render() {
      renderVehicles(map);

    }

    function renderVehicles(map) {
      // Load icons
      var iconPromises = [
        map.imageSprite.add('truck', 'https://raw.githubusercontent.com/Muhammad-Gouda/AzureMaps/master/images/truck_40.png'),
        map.imageSprite.add('excavator', 'https://raw.githubusercontent.com/Muhammad-Gouda/AzureMaps/master/images/excavator_40.png')
      ];

      
      

      Promise.all(iconPromises).then(renderVehiclesWithIcons(map))


    }

    function renderVehiclesWithIcons(map) {

      var vehiclesDataSource = new atlas.source.DataSource();

      map.sources.add(vehiclesDataSource);
      var vheicleIconOption = {
        iconOptions: {
          image: ['get', 'vehicleType'],
          allowOverlap: true
        }
      }
      var vehicleLayer = new atlas.layer.SymbolLayer(vehiclesDataSource, null, vheicleIconOption);
      map.layers.add(vehicleLayer);
      vehiclesDataSource.add(getVehiclesData());


    }
    /*
        function render() {
          //render vehicles
          //create empty vheicles data source
          var vehiclesDataSource = atlas.source.DataSource();
          //add the empty datasource to the current map object
          map.sources.Add(vehiclesDataSource);

          //create vheicle layer
          // Wait for icons to be ready
          Promise.all(iconPromises).then(function () {

            // Add a symbol layer to render the vehicle points
            var vehicleLayer = new atlas.layer.SymbolLayer(vehiclesDataSource, null, {

              iconOptions: {
                image: ['get', 'vehicleType'],
                allowOverlap: true
              }

            });
            map.layers.Add(vehicleLayer);
            vehiclesDataSource.add(getVehiclesData());
          })


        }
        */
  </script>

</body>

</html>